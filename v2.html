<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>…</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Great+Vibes&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

  <meta name="theme-color" content="#0b0b12" />

  <style>
    :root{
      --paper:#f6f0e7;
      --ink:#1a1a1a;
      --muted:#3a3a3a;
      --shadow: 0 24px 70px rgba(0,0,0,.55);
      --r: 22px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; scroll-behavior:smooth; }
    body{
      margin:0;
      background:#0b0b12;
      overflow-x:hidden;
      font-family:"Cormorant Garamond", serif;
    }

    .bg{
      position:fixed; inset:0; z-index:-4;
      background:
        radial-gradient(900px 650px at 20% 20%, rgba(255,180,120,.10), transparent 55%),
        radial-gradient(900px 650px at 80% 30%, rgba(120,200,255,.10), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.92));
    }
    #stars{ position:fixed; inset:0; z-index:-3; pointer-events:none; opacity:.50; }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:start center;
      padding:22px 16px 52px;
    }

    .paper{
      width:min(920px,100%);
      border-radius:var(--r);
      background: var(--paper);
      color: var(--ink);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
      border: 1px solid rgba(0,0,0,.08);
    }
    .content{ padding:22px 20px 18px; }

    .title{
      font-family:"Great Vibes", cursive;
      font-size:clamp(36px,5.4vw,58px);
      margin:8px 0 10px;
      opacity:0;
      transform:translateY(14px);
      transition:opacity 1s ease, transform 1s ease;
      color:#111;
    }
    .title.show{ opacity:1; transform:none; }

    .letter{ margin-top: 8px; max-width: 780px; }
    .line{
      font-size: 21px;
      line-height: 1.70;
      margin: 0;
      opacity:0;
      transform:translateY(10px);
      transition:opacity 1.05s ease, transform 1.05s ease;
      white-space: pre-wrap;
    }
    .line.show{ opacity:1; transform:none; }
    .spacer{ height:14px; }

    .photoBlock{
      margin: 18px 0 22px;
      display:grid;
      gap:14px;
      opacity:0;
      transform: translateY(12px);
      transition: opacity 1s ease, transform 1s ease;
    }
    .photoBlock.show{ opacity:1; transform:none; }
    .photoBlock.one{ grid-template-columns: 1fr; }
    .photoBlock.two{ grid-template-columns: 1fr 1fr; }
    @media (max-width: 640px){ .photoBlock.two{ grid-template-columns: 1fr; } }

    /* рамка “альбом” */
    .polaroid{
      position:relative;
      background:#fff;
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 18px 38px rgba(0,0,0,.20);
      border: 1px solid rgba(0,0,0,.08);
      transform: rotate(var(--rot, -2deg));
    }
    .photo{
      border-radius: 14px;
      overflow:hidden;
      background:#e9e1d7;
      aspect-ratio: 4/3;
    }
    .polaroid.wide .photo{ aspect-ratio: 16/9; }
    .photo img{ width:100%; height:100%; object-fit:contain; background:#e9e1d7; display:block; }

    .separator{
      height:1px;
      background:rgba(0,0,0,.10);
      margin:26px 0;
      opacity:0;
      transition:opacity 1s ease;
    }
    .separator.show{ opacity:1; }

    .cta{
      border:1px solid rgba(0,0,0,.12);
      border-radius:18px;
      padding:16px;
      background: rgba(255,255,255,.75);
      opacity:0;
      transform:translateY(14px);
      transition:opacity 1s ease, transform 1s ease;
    }
    .cta.show{ opacity:1; transform:none; }
    .ctaTitle{
      font-weight:700;
      font-family:"Montserrat", sans-serif;
      letter-spacing:.2px;
      color:#111;
    }
    .ctaHint{
      font-size:13.5px;
      color: var(--muted);
      margin-top:6px;
      line-height:1.35;
      font-family:"Montserrat", sans-serif;
    }
    .btn{
      margin-top:14px;
      width:100%;
      border:0;
      border-radius:16px;
      padding:14px;
      font-size:16px;
      font-weight:800;
      font-family:"Montserrat", sans-serif;
      background:#111;
      color:#fff;
      cursor:pointer;
      box-shadow:0 14px 34px rgba(0,0,0,.25);
    }
    .btn.invite{ animation: glow 3.5s ease-in-out infinite; }
    @keyframes glow{
      0%,100%{ box-shadow:0 14px 34px rgba(0,0,0,.25); transform:translateY(0); }
      50%{ box-shadow:0 18px 44px rgba(0,0,0,.35); transform:translateY(-1px); }
    }

    .footer{
      text-align:center;
      font-size:14px;
      color: rgba(0,0,0,.60);
      padding:14px 14px 16px;
      opacity:0;
      transition:opacity 1s ease;
      font-family:"Montserrat", sans-serif;
    }
    .footer.show{ opacity:1; }
  </style>
</head>

<body>
  <div class="bg"></div>
  <canvas id="stars"></canvas>

  <div class="wrap">
    <div class="paper" id="paper">
      <div class="content">
        <div class="title" id="title">Привет моя любимая жена…</div>
        <div class="letter" id="letter"></div>

        <div class="separator" id="sep"></div>

        <div class="cta" id="cta">
          <div class="ctaTitle">Тот самый момент — 1:23:08</div>
          <div class="ctaHint">
            Нажми кнопку — откроется фильм.<br>
            Если начнётся с начала — просто перемотай на <b>1:23:08</b>.
          </div>
          <button class="btn" id="playBtn">Посмотри...</button>
        </div>
      </div>
      <div class="footer" id="footer">Я всё ещё рядом.</div>
    </div>
  </div>

  <script>
    const startTime = 4988;
    const filmUrl = `https://www.kinopoisk.vip/film/5265603/?t=${startTime}&start=${startTime}#t=${startTime}`;

    const photos = ["111.jpg","222.jpg","333.jpg","4444.jpg","555.jpg","66.jpg","777.jpg","88.jpg","99.jpg","10.jpg"];
    function rot(i){ const arr=[-3.2,2.6,-1.8,3.1,-2.7,2.1,-1.3,2.9,-2.2,2.4]; return arr[i%arr.length]; }

    const letterText = `<?=TEXT?>`;

    let paragraphs = letterText.split("\n\n").map(p => p.trim()).filter(Boolean);
    if (paragraphs.length > 0 && paragraphs[0].startsWith("Привет моя любимая жена")) {
      paragraphs[0] = paragraphs[0].split("\n").slice(1).join("\n").trim();
      if (!paragraphs[0]) paragraphs.shift();
    }

    const photoLayout = [1,2,1,2,1,2,1];
    let photoIndex = 0;
    const letterEl = document.getElementById("letter");

    function addTextBlock(p){
      const lines = p.split("\n").map(x=>x.trim()).filter(Boolean);
      lines.forEach(t=>{
        const el = document.createElement("p");
        el.className = "line";
        el.textContent = t;
        letterEl.appendChild(el);
      });
      const sp = document.createElement("div");
      sp.className = "spacer";
      letterEl.appendChild(sp);
    }

    function addPhotoBlock(count){
      const block = document.createElement("div");
      block.className = `photoBlock ${count === 1 ? "one" : "two"}`;

      for(let i=0;i<count;i++){
        if(photoIndex >= photos.length) break;
        const card = document.createElement("div");
        const isWide = (count === 1);
        card.className = `polaroid ${isWide ? "wide" : ""}`;
        card.style.setProperty("--rot", `${rot(photoIndex)}deg`);
        const src = photos[photoIndex];
        card.innerHTML = `<div class="photo"><img src="${src}" alt="photo"></div>`;
        block.appendChild(card);
        photoIndex++;
      }

      letterEl.appendChild(block);
      const sp = document.createElement("div");
      sp.className = "spacer";
      letterEl.appendChild(sp);
    }

    const insertCount = photoLayout.length;
    const insertAfter = [];
    for(let i=1;i<=insertCount;i++){
      const idx = Math.floor(i * paragraphs.length / (insertCount + 1));
      insertAfter.push(Math.min(idx, paragraphs.length - 2));
    }

    let ins = 0;
    for(let i=0;i<paragraphs.length;i++){
      addTextBlock(paragraphs[i]);
      if(ins < insertCount && i === insertAfter[ins]){
        addPhotoBlock(photoLayout[ins]);
        ins++;
      }
    }

    const title = document.getElementById("title");
    const sep = document.getElementById("sep");
    const cta = document.getElementById("cta");
    const footer = document.getElementById("footer");

    setTimeout(()=>title.classList.add("show"), 450);

    const revealEls = Array.from(document.querySelectorAll("#letter .line, #letter .photoBlock"));
    let t = 750, step = 120;
    revealEls.forEach(el=>{
      setTimeout(()=>el.classList.add("show"), t);
      t += step;
      if(el.classList.contains("photoBlock")) t += 160;
    });

    const endTime = t + 260;
    setTimeout(()=>sep.classList.add("show"), endTime);
    setTimeout(()=>cta.classList.add("show"), endTime + 240);
    setTimeout(()=>{
      footer.classList.add("show");
      document.getElementById("playBtn").classList.add("invite");
    }, endTime + 720);

    document.getElementById("playBtn").onclick = () => window.open(filmUrl,"_blank");

    // Stars
    const c = document.getElementById("stars");
    const ctx = c.getContext("2d");
    function resize(){ c.width = innerWidth; c.height = innerHeight; }
    resize(); addEventListener("resize", resize);

    const stars = Array.from({length: 120}, () => ({
      x: Math.random()*innerWidth, y: Math.random()*innerHeight,
      r: 0.6 + Math.random()*1.6,
      vx: (-0.5 + Math.random())*0.06,
      vy: (-0.5 + Math.random())*0.08,
      t: Math.random()*Math.PI*2
    }));

    function draw(){
      ctx.clearRect(0,0,c.width,c.height);
      for(const s of stars){
        s.t += 0.01; s.x += s.vx; s.y += s.vy;
        if(s.x < -10) s.x = innerWidth+10;
        if(s.x > innerWidth+10) s.x = -10;
        if(s.y < -10) s.y = innerHeight+10;
        if(s.y > innerHeight+10) s.y = -10;
        const tw = (Math.sin(s.t)+1)*0.5;
        const alpha = 0.10 + tw*0.22;
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.beginPath(); ctx.arc(s.x, s.y, s.r*(0.85+tw*0.35), 0, Math.PI*2); ctx.fill();
      }
      requestAnimationFrame(draw);
    }
    draw();
  </script>
</body>
</html>
